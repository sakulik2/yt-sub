<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASS.jsåº“æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .warning {
            background: #fff3cd;
            border-color: #ffeeba;
            color: #856404;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        #log {
            height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            background: #f8f9fa;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ASS.jsåº“æµ‹è¯•é¡µé¢</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•ASS.jsåº“æ˜¯å¦èƒ½æ­£ç¡®åŠ è½½å’Œå·¥ä½œã€‚</p>
        
        <div id="browser-info" class="test-section">
            <h3>ğŸ“‹ æµè§ˆå™¨ä¿¡æ¯</h3>
            <p><strong>User Agent:</strong> <span id="userAgent"></span></p>
            <p><strong>Chromeç‰ˆæœ¬:</strong> <span id="chromeVersion"></span></p>
        </div>

        <div id="library-test" class="test-section">
            <h3>ğŸ“š åº“åŠ è½½æµ‹è¯•</h3>
            <button onclick="testLocalLibrary()">æµ‹è¯•æœ¬åœ°åº“</button>
            <button onclick="testCDNLibrary()">æµ‹è¯•CDNåº“</button>
            <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
            <div id="library-results"></div>
        </div>

        <div id="parsing-test" class="test-section">
            <h3>ğŸ“ ASSè§£ææµ‹è¯•</h3>
            <button onclick="testASSParsing()">æµ‹è¯•ASSè§£æ</button>
            <div id="parsing-results"></div>
        </div>

        <div id="video-test" class="test-section">
            <h3>ğŸ¥ è§†é¢‘æ¸²æŸ“æµ‹è¯•</h3>
            <video id="test-video" width="400" height="225" controls>
                <source src="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAr1tZGF0AAACrQYF//+c3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE2MSByMzAyMCA5OTdkNjBkIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAyMCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTEgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJfcHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTIga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAABWWWIhAA3//727L4FNf2f0JcRLMXaSnA+KqSAgHc0wAAAAwAAAwAAFgAABrBIQOdp" type="video/mp4">
                æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
            </video>
            <div id="subtitle-container" style="position: relative; width: 400px; height: 225px; background: #000;"></div>
            <button onclick="testVideoRendering()">æµ‹è¯•è§†é¢‘å­—å¹•æ¸²æŸ“</button>
            <div id="video-results"></div>
        </div>

        <div id="log-section" class="test-section">
            <h3>ğŸ“‹ æµ‹è¯•æ—¥å¿—</h3>
            <div id="log"></div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–é¡µé¢
        document.getElementById('userAgent').textContent = navigator.userAgent;
        
        const chromeMatch = navigator.userAgent.match(/Chrome\/(\d+)/);
        document.getElementById('chromeVersion').textContent = chromeMatch ? chromeMatch[1] : 'æœªçŸ¥';

        let logElement = document.getElementById('log');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            logElement.textContent += logEntry;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function setResult(elementId, content, className) {
            const element = document.getElementById(elementId);
            element.innerHTML = content;
            element.className = `test-section ${className}`;
        }

        function clearResults() {
            logElement.textContent = '';
            document.getElementById('library-results').innerHTML = '';
            document.getElementById('parsing-results').innerHTML = '';
            document.getElementById('video-results').innerHTML = '';
        }

        // æµ‹è¯•æœ¬åœ°åº“
        function testLocalLibrary() {
            log('å¼€å§‹æµ‹è¯•æœ¬åœ°ASS.jsåº“...');
            
            if (typeof window.ASS !== 'undefined') {
                log('æœ¬åœ°ASS.jsåº“å·²å­˜åœ¨', 'success');
                setResult('library-results', 'âœ… æœ¬åœ°åº“å·²åŠ è½½ä¸”å¯ç”¨', 'success');
                return;
            }

            log('å°è¯•åŠ è½½æœ¬åœ°åº“...');
            const script = document.createElement('script');
            script.src = './assjs.min.js';
            script.onload = () => {
                if (typeof window.ASS !== 'undefined') {
                    log('æœ¬åœ°ASS.jsåº“åŠ è½½æˆåŠŸ', 'success');
                    setResult('library-results', 'âœ… æœ¬åœ°åº“åŠ è½½æˆåŠŸ', 'success');
                } else {
                    log('æœ¬åœ°åº“åŠ è½½åASSå¯¹è±¡ä»æœªæ‰¾åˆ°', 'error');
                    setResult('library-results', 'âŒ æœ¬åœ°åº“åŠ è½½å¤±è´¥ï¼ˆå¯èƒ½æ˜¯ES6æ¨¡å—ï¼‰', 'error');
                }
            };
            script.onerror = () => {
                log('æœ¬åœ°åº“æ–‡ä»¶ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥', 'error');
                setResult('library-results', 'âŒ æœ¬åœ°åº“æ–‡ä»¶ä¸å­˜åœ¨', 'error');
            };
            document.head.appendChild(script);
        }

        // æµ‹è¯•CDNåº“
        function testCDNLibrary() {
            log('å¼€å§‹æµ‹è¯•CDN ASS.jsåº“...');
            
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/assjs@latest/dist/ass.global.js';
            script.onload = () => {
                if (typeof window.ASS !== 'undefined') {
                    log('CDN ASS.jsåº“åŠ è½½æˆåŠŸ', 'success');
                    setResult('library-results', 'âœ… CDNåº“åŠ è½½æˆåŠŸ', 'success');
                } else {
                    log('CDNåº“åŠ è½½åASSå¯¹è±¡ä»æœªæ‰¾åˆ°', 'error');
                    setResult('library-results', 'âŒ CDNåº“åŠ è½½å¤±è´¥', 'error');
                }
            };
            script.onerror = () => {
                log('CDNåº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
                setResult('library-results', 'âŒ CDNåº“åŠ è½½å¤±è´¥ï¼ˆç½‘ç»œé—®é¢˜ï¼‰', 'error');
            };
            document.head.appendChild(script);
        }

        // æµ‹è¯•ASSè§£æ
        function testASSParsing() {
            log('å¼€å§‹æµ‹è¯•ASSè§£æåŠŸèƒ½...');
            
            if (typeof window.ASS === 'undefined') {
                log('ASSåº“æœªåŠ è½½ï¼Œè¯·å…ˆåŠ è½½åº“', 'error');
                setResult('parsing-results', 'âŒ è¯·å…ˆåŠ è½½ASS.jsåº“', 'error');
                return;
            }

            const testASS = `[Script Info]
Title: æµ‹è¯•å­—å¹•
ScriptType: v4.00+

[V4+ Styles]
Format: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding
Style: Default,Microsoft YaHei,20,&H00FFFFFF,&H000000FF,&H00000000,&H80000000,0,0,0,0,100,100,0,0,1,2,0,2,10,10,10,1

[Events]
Format: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text
Dialogue: 0,0:00:01.00,0:00:03.00,Default,,0,0,0,,è¿™æ˜¯ä¸€æ¡æµ‹è¯•å­—å¹•
Dialogue: 0,0:00:04.00,0:00:06.00,Default,,0,0,0,,ASSåº“å·¥ä½œæ­£å¸¸ï¼`;

            try {
                log('å°è¯•è§£æASSå†…å®¹...');
                // è¿™é‡Œæˆ‘ä»¬åªæ˜¯æ£€æŸ¥èƒ½å¦å®ä¾‹åŒ–ï¼Œä¸å®é™…æ¸²æŸ“
                const tempVideo = document.createElement('video');
                const tempContainer = document.createElement('div');
                
                const instance = new window.ASS(testASS, tempVideo, {
                    container: tempContainer
                });
                
                log('ASSè§£ææˆåŠŸ', 'success');
                setResult('parsing-results', 'âœ… ASSè§£æåŠŸèƒ½æ­£å¸¸', 'success');
                
                // æ¸…ç†
                instance.destroy();
                
            } catch (error) {
                log(`ASSè§£æå¤±è´¥: ${error.message}`, 'error');
                setResult('parsing-results', `âŒ ASSè§£æå¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•è§†é¢‘æ¸²æŸ“
        function testVideoRendering() {
            log('å¼€å§‹æµ‹è¯•è§†é¢‘å­—å¹•æ¸²æŸ“...');
            
            if (typeof window.ASS === 'undefined') {
                log('ASSåº“æœªåŠ è½½ï¼Œè¯·å…ˆåŠ è½½åº“', 'error');
                setResult('video-results', 'âŒ è¯·å…ˆåŠ è½½ASS.jsåº“', 'error');
                return;
            }

            const video = document.getElementById('test-video');
            const container = document.getElementById('subtitle-container');
            
            const testASS = `[Script Info]
Title: è§†é¢‘æµ‹è¯•å­—å¹•
ScriptType: v4.00+

[V4+ Styles]
Format: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding
Style: Default,Microsoft YaHei,16,&H00FFFFFF,&H000000FF,&H00000000,&H80000000,0,0,0,0,100,100,0,0,1,2,0,2,10,10,10,1

[Events]
Format: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text
Dialogue: 0,0:00:01.00,0:00:05.00,Default,,0,0,0,,å­—å¹•æ¸²æŸ“æµ‹è¯•æˆåŠŸï¼
Dialogue: 0,0:00:06.00,0:00:10.00,Default,,0,0,0,,ASS.jsåº“å·¥ä½œæ­£å¸¸`;

            try {
                // æ¸…é™¤ä¹‹å‰çš„å­—å¹•
                container.innerHTML = '';
                
                log('åˆ›å»ºASSå®ä¾‹...');
                const assInstance = new window.ASS(testASS, video, {
                    container: container
                });
                
                log('è§†é¢‘å­—å¹•æ¸²æŸ“æˆåŠŸ', 'success');
                setResult('video-results', 'âœ… è§†é¢‘å­—å¹•æ¸²æŸ“æ­£å¸¸ï¼ˆæ’­æ”¾è§†é¢‘æŸ¥çœ‹æ•ˆæœï¼‰', 'success');
                
            } catch (error) {
                log(`è§†é¢‘æ¸²æŸ“å¤±è´¥: ${error.message}`, 'error');
                setResult('video-results', `âŒ è§†é¢‘æ¸²æŸ“å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹æ£€æŸ¥
        window.addEventListener('load', () => {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹æ£€æŸ¥...');
            
            if (typeof window.ASS !== 'undefined') {
                log('æ£€æµ‹åˆ°ASSåº“å·²é¢„åŠ è½½', 'success');
                setResult('library-results', 'âœ… ASSåº“å·²é¢„åŠ è½½', 'success');
            } else {
                log('ASSåº“æœªé¢„åŠ è½½ï¼Œéœ€è¦æ‰‹åŠ¨åŠ è½½', 'warning');
                setResult('library-results', 'âš ï¸ ASSåº“æœªé¢„åŠ è½½ï¼Œè¯·ç‚¹å‡»æŒ‰é’®æµ‹è¯•', 'warning');
            }
        });
    </script>
</body>
</html>